<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mail - Outlook</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f3f2f1;
        }

        .outlook-blue {
            background-color: #0f6cbd;
        }

        .chat-scroll::-webkit-scrollbar {
            width: 8px;
        }

        .chat-scroll::-webkit-scrollbar-track {
            background: transparent;
        }

        .chat-scroll::-webkit-scrollbar-thumb {
            background-color: #c8c6c4;
            border-radius: 4px;
        }

        .chat-scroll::-webkit-scrollbar-thumb:hover {
            background-color: #a19f9d;
        }

        /* Floating DM Window / Tile */
        .dm-window {
            box-shadow: 0 4px 14px rgba(0, 0, 0, 0.15);
            border: 1px solid #edebe9;
        }
    </style>
</head>

<body class="h-screen w-full flex flex-col overflow-hidden text-[#242424]">

    <!-- Login Modal (Login to O365 style) -->
    <div id="entry-modal"
        class="absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm transition-opacity duration-300">
        <div class="bg-white shadow-2xl w-full max-w-[440px] p-10">
            <div class="mb-4">
                <!-- Generic Microsoft-like logo -->
                <svg viewBox="0 0 23 23" class="w-8 h-8 inline-block">
                    <rect x="1" y="1" width="10" height="10" fill="#f25022" />
                    <rect x="12" y="1" width="10" height="10" fill="#7fba00" />
                    <rect x="1" y="12" width="10" height="10" fill="#00a4ef" />
                    <rect x="12" y="12" width="10" height="10" fill="#ffb900" />
                </svg>
                <span class="text-xl font-semibold ml-2 text-[#737373] align-middle">Microsoft</span>
            </div>
            <h1 class="text-2xl font-semibold mb-2">Sign in</h1>
            <p class="text-[15px] mb-6">to continue to Outlook</p>
            <form id="join-form" class="space-y-4">
                <div>
                    <input type="text" id="username-input" autocomplete="off" required
                        placeholder="Email, phone, or Skype (Your Display Name)"
                        class="w-full px-3 py-1.5 border-b border-gray-400 focus:border-blue-600 focus:border-b-2 focus:outline-none transition-colors text-[15px] pb-2" />
                </div>
                <div class="flex justify-end pt-4">
                    <button type="submit"
                        class="bg-[#0067b8] hover:bg-[#005da6] text-white px-8 py-1.5 text-[15px] transition-colors">
                        Next
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Main Outlook App container -->
    <div id="main-app" class="hidden h-full flex flex-col w-full transition-opacity duration-300">

        <!-- Top Nav -->
        <header class="outlook-blue h-12 flex items-center justify-between px-4 text-white shrink-0 shadow-sm z-20">
            <div class="flex items-center gap-4">
                <!-- Waffle Icon -->
                <button class="hover:bg-white/10 p-2 rounded transition-colors">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path
                            d="M4 4h4v4H4V4zm6 0h4v4h-4V4zm6 0h4v4h-4V4zM4 10h4v4H4v-4zm6 0h4v4h-4v-4zm6 0h4v4h-4v-4zM4 16h4v4H4v-4zm6 0h4v4h-4v-4zm6 0h4v4h-4v-4z" />
                    </svg>
                </button>
                <span class="font-semibold text-base tracking-wide">Outlook</span>
            </div>

            <!-- Fake Search Bar -->
            <div
                class="hidden md:flex bg-white/20 hover:bg-white/30 rounded xl:w-[600px] lg:w-[400px] md:w-[300px] h-8 items-center px-3 transition-colors cursor-text">
                <svg class="w-4 h-4 text-white/70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                <span class="text-white/70 text-sm ml-2">Search</span>
            </div>

            <div class="flex items-center gap-3">
                <div id="current-datetime" class="hidden md:block text-xs font-medium opacity-90"></div>
                <!-- Admin Lock/Settings -->
                <button id="admin-trigger" class="hover:bg-white/10 p-2 rounded relative" title="Settings">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                        </path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                </button>
                <!-- Notifications Bell -->
                <button class="hover:bg-white/10 p-2 rounded relative">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9">
                        </path>
                    </svg>
                    <span id="unread-badge"
                        class="absolute top-1.5 right-1.5 w-2 h-2 bg-red-500 rounded-full hidden"></span>
                </button>
                <!-- Avatar -->
                <div id="my-avatar"
                    class="w-8 h-8 rounded-full bg-orange-700 flex items-center justify-center text-sm font-semibold cursor-pointer border border-white/20">
                    ME</div>
            </div>
        </header>

        <div class="flex flex-1 overflow-hidden">
            <!-- Left Sidebar (Folders) - Hidden on mobile -->
            <aside class="hidden md:flex w-56 flex-col bg-[#f3f2f1] border-r border-[#edebe9] shrink-0">
                <div class="p-3">
                    <button
                        class="hidden lg:hidden items-center text-[#242424] hover:bg-[#edebe9] w-full text-left px-2 py-1 transition-colors">
                        <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
                <nav class="flex-1 space-y-0.5 mt-2">
                    <a href="#"
                        class="flex items-center px-4 py-2 bg-white text-[#0f6cbd] font-semibold border-l-2 border-[#0f6cbd]">
                        <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4">
                            </path>
                        </svg>
                        Inbox <span class="ml-auto text-xs font-normal" id="nav-count">0</span>
                    </a>
                    <a href="#" class="flex items-center px-4 py-2 text-[#242424] hover:bg-[#edebe9] transition-colors">
                        <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                        </svg>
                        Sent Items
                    </a>
                    <a href="#" class="flex items-center px-4 py-2 text-[#242424] hover:bg-[#edebe9] transition-colors">
                        <svg class="w-4 h-4 mr-3 text-[#242424]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                            </path>
                        </svg>
                        Drafts
                    </a>
                    <a href="#" class="flex items-center px-4 py-2 text-[#242424] hover:bg-[#edebe9] transition-colors">
                        <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7">
                            </path>
                        </svg>
                        Deleted Items
                    </a>
                </nav>
            </aside>

            <!-- Middle Column (Message List -> Actually "Connected Terminals/Users") -->
            <div class="w-full md:w-72 lg:w-80 border-r border-[#edebe9] bg-white flex flex-col shrink-0"
                id="middle-pane">
                <div class="p-3 border-b border-[#edebe9]">
                    <h2 class="text-xl font-semibold mb-3">Chats</h2>
                    <div class="flex gap-4 border-b border-[#edebe9] text-[13px] font-medium text-[#605e5c]">
                        <button class="pb-1 border-b-2 border-[#0f6cbd] text-[#242424]">Group Inbox</button>
                        <button class="pb-1 hover:text-[#242424]">Contacts (<span id="active-count">1</span>)</button>
                    </div>
                </div>

                <!-- Active users (Contacts list) masquerading as an email inbox list -->
                <ul id="active-users-list" class="flex-1 overflow-y-auto chat-scroll divide-y divide-[#f3f2f1]">
                    <!-- Users injected here -->
                </ul>
            </div>

            <!-- Right Column (Reading Pane -> Chat Messages) -->
            <main class="hidden md:flex flex-1 flex-col bg-white relative" id="right-pane">
                <!-- Info Header -->
                <div class="px-6 py-4 border-b border-[#edebe9] bg-white shrink-0 flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div>
                            <h2 class="text-lg font-semibold text-[#242424]">Global Inbox Thread</h2>
                            <div class="text-xs text-[#605e5c] mt-1 space-x-3">
                                <span>To: <strong>All Company Participants</strong></span>
                            </div>
                        </div>
                        <!-- Admin Panel (Hidden) -->
                        <div id="admin-panel" class="hidden ml-6 pl-6 border-l border-[#edebe9]">
                            <button id="purge-btn"
                                class="bg-red-50 text-red-600 hover:bg-red-100 hover:text-red-700 px-3 py-1.5 rounded text-sm font-medium transition-colors border border-red-200">
                                Purge All Data
                            </button>
                        </div>
                    </div>
                    <!-- Close button on mobile to go back to middle pane -->
                    <button id="mobile-back-btn" class="md:hidden text-[#242424] p-2 hover:bg-[#edebe9] rounded-full">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                    </button>
                </div>

                <!-- Messages Area -->
                <div id="messages-container" class="flex-1 overflow-y-auto p-6 space-y-6 chat-scroll bg-white">
                    <!-- Messages will be injected here -->
                </div>

                <!-- Input Area (Looks like Outlook compose reply) -->
                <div class="p-4 bg-white border-t border-[#edebe9] shrink-0 m-4 rounded shadow-sm border">
                    <form id="chat-form" class="flex flex-col gap-2 relative">
                        <!-- Toolbar fake -->
                        <div class="flex gap-2 text-[#605e5c] border-b border-[#edebe9] pb-2 px-2">
                            <svg class="w-4 h-4 cursor-pointer hover:text-[#242424]" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13">
                                </path>
                            </svg>
                            <svg class="w-4 h-4 cursor-pointer hover:text-[#242424]" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                </path>
                            </svg>
                        </div>
                        <div class="flex">
                            <input type="text" id="message-input" autocomplete="off" placeholder="Write a reply..."
                                class="flex-1 px-2 py-3 bg-transparent focus:outline-none text-[15px] text-[#242424] placeholder-[#a19f9d]" />
                        </div>
                        <div class="flex justify-between items-center mt-2 px-1">
                            <button type="submit"
                                class="bg-[#0f6cbd] hover:bg-[#005da6] text-white rounded px-5 py-1.5 font-medium transition-colors text-sm flex items-center">
                                Send <svg class="w-4 h-4 ml-2 transform -rotate-45" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                                </svg>
                            </button>
                        </div>
                    </form>
                </div>
            </main>
        </div>
    </div>

    <!-- Direct Messages Container (Tiles pinned to bottom right) -->
    <div id="dm-container" class="fixed bottom-0 right-10 flex gap-4 z-50 items-end pointer-events-none">
        <!-- Floating chat windows mapped here dynamically -->
    </div>

    <!-- Socket.IO via npm/Express -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="/app.js"></script>
</body>

</html>